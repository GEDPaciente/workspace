name: 'ğŸ›ï¸ Module FLOW'
description: 'Fluxo de atualizaÃ§Ã£o do Modulo'
inputs:
  release_branch:
    description: 'Branch de release'
    required: true
  github_token:
    description: 'Token de acesso ao Github'
    required: true
runs:
  using: 'composite'
  steps:
    - name: ğŸ”’ Verificar GitHub Token
      run: |
        if [ -z "${{ inputs.github_token }}" ]; then
          echo "GitHub Token nÃ£o fornecido."
          exit 1
        else
          echo "GitHub Token estÃ¡ presente."
        fi
      shell: bash

    - name: ğŸšš Atualizando projeto
      uses: actions/checkout@v3
      with:
        repository: GEDPaciente/mv-ged-workspace
        token: ${{ inputs.github_token }}
        submodules: true
        ref: ${{ github.ref }}

    - name: ğŸ“ Obtem a VersÃ£o do workspace
      id: get_actual_version
      run: |
        echo "Obtendo versÃ£o do pom.xml"
        ACTUAL_VERSION=$(mvn help:evaluate -Dexpression=project.version -q -DforceStdout)
        echo "::set-output name=version::$ACTUAL_VERSION"
      shell: bash

    - name: ğŸ“ Gera a nova versÃ£o
      id: get_new_version
      uses: GedPaciente/workflows/get-and-check-version
      with:
        release_branch: ${{ inputs.release_branch }}

    - name: ğŸ“ Atualiza a versÃ£o no pom.xml
      run: |
        echo "Atualizando versÃ£o no pom.xml"
        mvn versions:set -DnewVersion=${{ steps.get_new_version.outputs.version }} -DgenerateBackupPoms=false
      shell: bash

    - name: Apresenta nova versÃ£o
      run: |
        ACTUAL_VERSION=$(mvn help:evaluate -Dexpression=project.version -q -DforceStdout)
        echo "Nova versÃ£o do projeto: $ACTUAL_VERSION"
      shell: bash
